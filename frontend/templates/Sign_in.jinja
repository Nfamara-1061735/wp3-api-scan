{% extends "base.jinja" %}

{% block title %}Inloggen{% endblock %}
{% block logout %} {% endblock %}

{% block content %}
<main role="main" id="main-content" tabindex="-1">
    <h1 class="my-5 text-center">Log in bij Stichting Accessibility HUB</h1>

    <form id="login-form" class="login-card mx-auto p-4 bg-light-subtle shadow" method="post" role="form" aria-labelledby="login-heading" style="max-width: 400px;">

        <div id="error-message" class="alert alert-danger visually-hidden" role="alert" aria-live="assertive"></div>

        <div class="mb-3">
            <label for="email-adres" class="form-label">E-mailadres</label>
            <input type="email"
                   class="form-control"
                   id="email-adres"
                   name="email"
                   placeholder="Vul uw e-mailadres in"
                   autocomplete="email"
                   required
                   aria-required="true">
        </div>

        <div class="mb-4">
            <label for="password" class="form-label">Wachtwoord</label>
            <input type="password"
                   class="form-control"
                   id="password"
                   name="password"
                   placeholder="Vul uw wachtwoord in"
                   autocomplete="current-password"
                   required
                   aria-required="true">
        </div>

        <button type="submit" class="btn btn-primary w-100" aria-label="Log in bij Stichting Accessibility">Inloggen</button>
    </form>
</main>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function () {
        $('#login-form').submit(function (event) {
            event.preventDefault(); // Voorkom standaardformulierverzending

            // Foutmelding verbergen
            $('#error-message').addClass('visually-hidden').text('');

            const email = $('#email-adres').val().trim();
            const password = $('#password').val().trim();

            if (!email || !password) {
                $('#error-message')
                    .removeClass('visually-hidden')
                    .text('Vul zowel uw e-mailadres als wachtwoord in.');
                return;
            }

            $.ajax({
                url: '/api/login?role={{ role }}',
                type: 'POST',
                headers: {
                    email: email,
                    password: password
                },
                success: function (response) {
                    if (response.success) {
                        window.location.href = '{{ target_redirect }}';
                    } else {
                        $('#error-message')
                            .removeClass('visually-hidden')
                            .text(response.message || 'Inloggen mislukt, probeer het opnieuw.');
                    }
                },
                error: function () {
                    $('#error-message')
                        .removeClass('visually-hidden')
                        .text('Er is een fout opgetreden. Probeer het later opnieuw.');
                }
            });
        });
    });
</script>
{% endblock %}